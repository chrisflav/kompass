<!DOCTYPE html>

<html :class="{'dark': darkMode === 'dark' || (darkMode === 'system' &amp;&amp; window.matchMedia('(prefers-color-scheme: dark)').matches)}" class="scroll-smooth" data-content_root="../" lang="de" x-data="{ darkMode: localStorage.getItem('darkMode') || localStorage.setItem('darkMode', 'system'), activeSection: '' }" x-init="$watch('darkMode', val =&gt; localStorage.setItem('darkMode', val))">
<head>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta charset="utf-8"/>
<meta content="white" media="(prefers-color-scheme: light)" name="theme-color"/>
<meta content="black" media="(prefers-color-scheme: dark)" name="theme-color"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Production Deployment | Kompass 2.0 Dokumentation</title>
<meta content="Production Deployment | Kompass 2.0 Dokumentation" property="og:title"/>
<meta content="Production Deployment | Kompass 2.0 Dokumentation" name="twitter:title"/>
<link href="../_static/pygments.css?v=4bdb26dd" rel="stylesheet" type="text/css"/>
<link href="../_static/theme.css?v=42baaae4" rel="stylesheet" type="text/css"/>
<link href="../_static/favicon.svg" rel="icon"/>
<link href="../search.html" rel="search" title="Suche"/>
<link href="../genindex.html" rel="index" title="Stichwortverzeichnis"/>
<link href="testing.html" rel="prev" title="Testing"/>
<script>
    <!-- Prevent Flash of wrong theme -->
      const userPreference = localStorage.getItem('darkMode');
      let mode;
      if (userPreference === 'dark' || window.matchMedia('(prefers-color-scheme: dark)').matches) {
        mode = 'dark';
        document.documentElement.classList.add('dark');
      } else {
        mode = 'light';
      }
      if (!userPreference) {localStorage.setItem('darkMode', mode)}
    </script>
</head>
<body :class="{ 'overflow-hidden': showSidebar }" @scroll.window="showScrollTop = pageYOffset &gt; 100" class="min-h-screen font-sans antialiased bg-background text-foreground" x-data="{ showSidebar: false, showScrollTop: false }">
<div @click.self="showSidebar = false" class="fixed inset-0 z-50 overflow-hidden bg-background/80 backdrop-blur-sm md:hidden" x-cloak="" x-show="showSidebar"></div><div class="relative flex flex-col min-h-screen" id="page"><a class="absolute top-0 left-0 z-[100] block bg-background p-4 text-xl transition -translate-x-full opacity-0 focus:translate-x-0 focus:opacity-100" href="#content">
      Skip to content
    </a><header class="sticky top-0 z-40 w-full border-b shadow-sm border-border supports-backdrop-blur:bg-background/60 bg-background/95 backdrop-blur"><div class="container flex items-center h-14">
<div class="hidden mr-4 md:flex">
<a class="flex items-center mr-6" href="../index.html">
<img alt="Logo" class="mr-2 dark:invert" height="24" src="../_static/favicon.svg" width="24"/><span class="hidden font-bold sm:inline-block text-clip whitespace-nowrap">Kompass 2.0 Dokumentation</span>
</a><nav class="flex items-center space-x-6 text-sm font-medium">
<a class="transition-colors hover:text-foreground/80 text-foreground/60" href="../index.html">Docs</a>
<a class="transition-colors hover:text-foreground/80 text-foreground/60" href="../about.html">About</a>
</nav></div><button @click="showSidebar = true" class="inline-flex items-center justify-center h-10 px-0 py-2 mr-2 text-base font-medium transition-colors rounded-md hover:text-accent-foreground hover:bg-transparent md:hidden" type="button">
<svg aria-hidden="true" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M152.587 825.087q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440Zm0-203.587q-19.152 0-32.326-13.174T107.087 576q0-19.152 13.174-32.326t32.326-13.174h320q19.152 0 32.326 13.174T518.087 576q0 19.152-13.174 32.326T472.587 621.5h-320Zm0-203.587q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440ZM708.913 576l112.174 112.174q12.674 12.674 12.674 31.826t-12.674 31.826Q808.413 764.5 789.261 764.5t-31.826-12.674l-144-144Q600 594.391 600 576t13.435-31.826l144-144q12.674-12.674 31.826-12.674t31.826 12.674q12.674 12.674 12.674 31.826t-12.674 31.826L708.913 576Z"></path>
</svg>
<span class="sr-only">Toggle navigation menu</span>
</button>
<div class="flex items-center justify-between flex-1 space-x-2 sm:space-x-4 md:justify-end">
<div class="flex-1 w-full md:w-auto md:flex-none"><form @keydown.k.window.meta="$refs.search.focus()" action="../search.html" class="relative flex items-center group" id="searchbox" method="get">
<input aria-label="Search the docs" class="inline-flex items-center font-medium transition-colors bg-transparent focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ring-offset-background border border-input hover:bg-accent focus:bg-accent hover:text-accent-foreground focus:text-accent-foreground hover:placeholder-accent-foreground py-2 px-4 relative h-9 w-full justify-start rounded-[0.5rem] text-sm text-muted-foreground sm:pr-12 md:w-40 lg:w-64" id="search-input" name="q" placeholder="Search ..." type="search" x-ref="search"/>
<kbd class="pointer-events-none absolute right-1.5 top-2 hidden h-5 select-none text-muted-foreground items-center gap-1 rounded border border-border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100 sm:flex group-hover:bg-accent group-hover:text-accent-foreground">
<span class="text-xs">⌘</span>
    K
  </kbd>
</form>
</div>
<nav class="flex items-center space-x-1">
<button @click="darkMode = darkMode === 'light' ? 'dark' : 'light'" aria-label="Color theme switcher" class="relative inline-flex items-center justify-center px-0 text-sm font-medium transition-colors rounded-md hover:bg-accent hover:text-accent-foreground h-9 w-9" type="button">
<svg class="absolute transition-all scale-100 rotate-0 dark:-rotate-90 dark:scale-0" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 685q45.456 0 77.228-31.772Q589 621.456 589 576q0-45.456-31.772-77.228Q525.456 467 480 467q-45.456 0-77.228 31.772Q371 530.544 371 576q0 45.456 31.772 77.228Q434.544 685 480 685Zm0 91q-83 0-141.5-58.5T280 576q0-83 58.5-141.5T480 376q83 0 141.5 58.5T680 576q0 83-58.5 141.5T480 776ZM80 621.5q-19.152 0-32.326-13.174T34.5 576q0-19.152 13.174-32.326T80 530.5h80q19.152 0 32.326 13.174T205.5 576q0 19.152-13.174 32.326T160 621.5H80Zm720 0q-19.152 0-32.326-13.174T754.5 576q0-19.152 13.174-32.326T800 530.5h80q19.152 0 32.326 13.174T925.5 576q0 19.152-13.174 32.326T880 621.5h-80Zm-320-320q-19.152 0-32.326-13.174T434.5 256v-80q0-19.152 13.174-32.326T480 130.5q19.152 0 32.326 13.174T525.5 176v80q0 19.152-13.174 32.326T480 301.5Zm0 720q-19.152 0-32.326-13.17Q434.5 995.152 434.5 976v-80q0-19.152 13.174-32.326T480 850.5q19.152 0 32.326 13.174T525.5 896v80q0 19.152-13.174 32.33-13.174 13.17-32.326 13.17ZM222.174 382.065l-43-42Q165.5 327.391 166 308.239t13.174-33.065q13.435-13.674 32.587-13.674t32.065 13.674l42.239 43q12.674 13.435 12.555 31.706-.12 18.272-12.555 31.946-12.674 13.674-31.445 13.413-18.772-.261-32.446-13.174Zm494 494.761-42.239-43q-12.674-13.435-12.674-32.087t12.674-31.565Q686.609 756.5 705.38 757q18.772.5 32.446 13.174l43 41.761Q794.5 824.609 794 843.761t-13.174 33.065Q767.391 890.5 748.239 890.5t-32.065-13.674Zm-42-494.761Q660.5 369.391 661 350.62q.5-18.772 13.174-32.446l41.761-43Q728.609 261.5 747.761 262t33.065 13.174q13.674 13.435 13.674 32.587t-13.674 32.065l-43 42.239q-13.435 12.674-31.706 12.555-18.272-.12-31.946-12.555Zm-495 494.761Q165.5 863.391 165.5 844.239t13.674-32.065l43-42.239q13.435-12.674 32.087-12.674t31.565 12.674Q299.5 782.609 299 801.38q-.5 18.772-13.174 32.446l-41.761 43Q231.391 890.5 212.239 890t-33.065-13.174ZM480 576Z"></path>
</svg>
<svg class="absolute transition-all scale-0 rotate-90 dark:rotate-0 dark:scale-100" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 936q-151 0-255.5-104.5T120 576q0-138 90-239.5T440 218q25-3 39 18t-1 44q-17 26-25.5 55t-8.5 61q0 90 63 153t153 63q31 0 61.5-9t54.5-25q21-14 43-1.5t19 39.5q-14 138-117.5 229T480 936Zm0-80q88 0 158-48.5T740 681q-20 5-40 8t-40 3q-123 0-209.5-86.5T364 396q0-20 3-40t8-40q-78 32-126.5 102T200 576q0 116 82 198t198 82Zm-10-270Z"></path>
</svg>
</button>
</nav>
</div>
</div>
</header>
<div class="flex-1"><div class="container flex-1 items-start md:grid md:grid-cols-[220px_minmax(0,1fr)] md:gap-6 lg:grid-cols-[240px_minmax(0,1fr)] lg:gap-10"><aside :aria-hidden="!showSidebar" :class="{ 'translate-x-0': showSidebar }" class="fixed inset-y-0 left-0 md:top-14 z-50 md:z-30 bg-background md:bg-transparent transition-all duration-100 -translate-x-full md:translate-x-0 ml-0 p-6 md:p-0 md:-ml-2 md:h-[calc(100vh-3.5rem)] w-5/6 md:w-full shrink-0 overflow-y-auto border-r border-border md:sticky" id="left-sidebar">
<a class="!justify-start text-sm md:!hidden bg-background" href="../index.html">
<img alt="Logo" class="mr-2 dark:invert" height="16" src="../_static/favicon.svg" width="16"/><span class="font-bold text-clip whitespace-nowrap">Kompass 2.0 Dokumentation</span>
</a>
<div class="relative overflow-hidden md:overflow-auto my-4 md:my-0 h-[calc(100vh-8rem)] md:h-auto">
<div class="overflow-y-auto h-full w-full relative pr-6"><nav class="flex md:hidden flex-col font-medium mt-4">
<a href="../index.html">Docs</a>
<a href="../about.html">About</a>
</nav><nav class="table w-full min-w-full my-6 lg:my-8">
<ul>
<li class="toctree-l1" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="../user_manual/index.html">Nutzer Dokumentation<button @click.prevent.stop="expanded = !expanded" type="button"><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul x-show="expanded">
<li class="toctree-l2"><a class="reference internal" href="../user_manual/getstarted.html">Erste Schritte</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user_manual/members.html">Teilnehmer*innenverwaltung</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user_manual/myprofile.html">Mein Profil</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user_manual/excursions.html">Ausfahrten</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user_manual/waitinglist.html">Warteliste und neue Mitglieder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user_manual/finance.html">Finanzen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user_manual/training.html">Fortbildungen</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="index.html">Development Documentation<button @click.prevent.stop="expanded = !expanded" type="button"><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul class="current" x-show="expanded">
<li class="toctree-l2"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup.html">Development Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="authentication.html">Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Production Deployment</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
<button @click="showSidebar = false" class="absolute md:hidden right-4 top-4 rounded-sm opacity-70 transition-opacity hover:opacity-100" type="button">
<svg class="h-4 w-4" fill="currentColor" height="24" stroke="none" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 632 284 828q-11 11-28 11t-28-11q-11-11-11-28t11-28l196-196-196-196q-11-11-11-28t11-28q11-11 28-11t28 11l196 196 196-196q11-11 28-11t28 11q11 11 11 28t-11 28L536 576l196 196q11 11 11 28t-11 28q-11 11-28 11t-28-11L480 632Z"></path>
</svg>
</button>
</aside>
<main class="relative py-6 lg:gap-10 lg:py-8 xl:grid xl:grid-cols-[1fr_300px]">
<div class="w-full min-w-0 mx-auto">
<nav aria-label="breadcrumbs" class="flex items-center mb-4 space-x-1 text-sm text-muted-foreground">
<a class="overflow-hidden text-ellipsis whitespace-nowrap hover:text-foreground" href="../index.html">
<span class="hidden md:inline">Kompass 2.0 Dokumentation</span>
<svg aria-label="Home" class="md:hidden" fill="currentColor" height="18" stroke="none" viewbox="0 96 960 960" width="18" xmlns="http://www.w3.org/2000/svg">
<path d="M240 856h120V616h240v240h120V496L480 316 240 496v360Zm-80 80V456l320-240 320 240v480H520V696h-80v240H160Zm320-350Z"></path>
</svg>
</a>
<div class="mr-1">/</div><a class="hover:text-foreground overflow-hidden text-ellipsis whitespace-nowrap" href="index.html">Development Documentation</a>
<div class="mr-1">/</div><span aria-current="page" class="font-medium text-foreground overflow-hidden text-ellipsis whitespace-nowrap">Production Deployment</span>
</nav>
<div id="content" role="main">
<section id="production-deployment">
<span id="development-manual-deployment"></span><h1>Production Deployment<a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#production-deployment">¶</a></h1>
<p>The production setup is based on the docker configuration in the <code class="docutils literal notranslate"><span class="pre">production/</span></code> folder of the repository. In
contrast to the development setup, there is no database service configured in the <code class="docutils literal notranslate"><span class="pre">docker-compose.yaml</span></code>. This
is to allow for a more flexible setup with a database service installed on the host, for which it is easier
to ensure data safety.</p>
<section id="initial-installation">
<span id="user-manual-initial-installation"></span><h2>Initial installation<a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#initial-installation" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#initial-installation'">¶</a></h2>
<p>We give here step-by-step instructions how to set up an initial Kompass installation starting from a fresh
Debian Bookworm installation. Of course these steps can be easily adapted to a different Linux distribution,
the steps will mostly differ in the way the system dependencies are installed.</p>
<p>The instructions describe the recommended setup with a docker-independent MySQL database server on the host system.</p>
<p>We assume that all instructions are executed as <code class="docutils literal notranslate"><span class="pre">root</span></code> or with <code class="docutils literal notranslate"><span class="pre">sudo</span></code>.</p>
<ol class="arabic">
<li><p>Install the dependencies: To install <code class="docutils literal notranslate"><span class="pre">docker</span></code>, please follow the <a class="reference external" href="https://docs.docker.com/engine/install/debian/">official instructions</a>. For the MySQL
server, run the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="go">apt install mariadb-server</span>
</span></code></pre></div>
</div>
</li>
<li><p>Setup the database: We need to create the database and create a user with a strong password. To generate
a strong password, run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="go">PASSWORD=$(tr -dc 'A-Za-z0-9' &lt; /dev/urandom | head -c 24)</span>
</span></code></pre></div>
</div>
<p>Now create a MySQL user with the generated password, by executing:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="go">mysql &lt;&lt;EOF</span>
</span><span id="line-2"><span class="go">CREATE USER 'kompass'@'10.26.42.0/255.255.255.0' IDENTIFIED BY '$PASSWORD';</span>
</span><span id="line-3"><span class="go">GRANT ALL PRIVILEGES ON kompass.* to 'kompass'@'10.26.42.0/255.255.255.0';</span>
</span><span id="line-4"><span class="go">FLUSH PRIVILEGES;</span>
</span><span id="line-5"><span class="go">EOF</span>
</span></code></pre></div>
</div>
<p>To make the MySQL server available from the docker container, edit <code class="docutils literal notranslate"><span class="pre">/etc/mysql/mariadb.cnf</span></code> and
uncomment the <code class="docutils literal notranslate"><span class="pre">port</span></code> line in the <code class="docutils literal notranslate"><span class="pre">[client-server]</span></code> code block. It could then look like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="go">[client-server]</span>
</span><span id="line-2"><span class="go">port = 3306</span>
</span><span id="line-3"><span class="go">socket = /run/mysqld/mysqld.sock</span>
</span></code></pre></div>
</div>
<p>Finally, edit <code class="docutils literal notranslate"><span class="pre">/etc/mysql/mariadb.conf.d/50-server.cnf</span></code> and add <code class="docutils literal notranslate"><span class="pre">10.26.42.1</span></code> <a class="footnote-reference brackets" href="#ip-address" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> to the
<code class="docutils literal notranslate"><span class="pre">bind-address</span></code> line. It could then look like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="go">bind-address  = 127.0.0.1,10.26.42.1</span>
</span></code></pre></div>
</div>
<p>Now restart the MySQL database by running:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="go">systemctl restart mariadb.service</span>
</span></code></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Bemerkung</p>
<p>If you are running a firewall service, you will need to allow connections to the <code class="docutils literal notranslate"><span class="pre">3306</span></code> port
from the <code class="docutils literal notranslate"><span class="pre">10.26.42.0/24</span></code> subnet. If you use <code class="docutils literal notranslate"><span class="pre">ufw</span></code>, you can do:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="go">ufw allow from 10.26.42.0/24 to 10.26.42.1 port 3306</span>
</span></code></pre></div>
</div>
</div>
</li>
<li><p>Install Kompass:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="go">mkdir /opt/kompass</span>
</span><span id="line-2"><span class="go">cd /opt/kompass</span>
</span></code></pre></div>
</div>
<p>Copy the contents of the <code class="docutils literal notranslate"><span class="pre">deploy/</span></code> directory of the Kompass repository into this folder. Afterwards,
the folder structure should look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span id="line-1">.
</span><span id="line-2">├── config
</span><span id="line-3">│   └── settings.toml
</span><span id="line-4">└── docker-compose.yaml
</span></code></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Bemerkung</p>
<p>As long as the Kompass repository is private, you need to ask the maintainers to add a read-only deploy
key for your installation to the <a class="reference external" href="https://git.jdav-hd.merten.dev/digitales/kompass">Gitea</a>. Then you can add a <code class="docutils literal notranslate"><span class="pre">.ssh</span></code> config file on your server with a
section</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="go">Host git.jdav-hd.merten.dev</span>
</span><span id="line-2"><span class="go">    HostName git.jdav-hd.merten.dev</span>
</span><span id="line-3"><span class="go">    User git</span>
</span><span id="line-4"><span class="go">    IdentityFile ~/.ssh/your_deploy_key</span>
</span></code></pre></div>
</div>
</div>
<p>Now set the password of the MySQL user in the <code class="docutils literal notranslate"><span class="pre">settings.toml</span></code> by running</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="go">sed -i "s/kompass-db-user-password/$PASSWORD/g" config/settings.toml</span>
</span></code></pre></div>
</div>
<p>Finally, we can start the docker containers for the first time by running:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="go">docker compose up --build</span>
</span></code></pre></div>
</div>
<p>This will start building the docker images and then launch the application. If everything
works as expected, there should be no error messages. In this case open a second terminal,
navigate to <code class="docutils literal notranslate"><span class="pre">/opt/kompass/</span></code> and run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="go">docker compose exec master bash</span>
</span><span id="line-2"><span class="go">cd jdav_web</span>
</span><span id="line-3"><span class="go">python3 manage.py createsuperuser</span>
</span></code></pre></div>
</div>
<p>This will prompt you for a username and a password for the initial admin user. Use a strong password
and don’t use the same password as the one for the MySQL user above!</p>
<p>The webserver will be available on <code class="docutils literal notranslate"><span class="pre">localhost</span></code> on port <code class="docutils literal notranslate"><span class="pre">3000</span></code>. To expose it to the
outer world, we need to setup a web server, such as <code class="docutils literal notranslate"><span class="pre">apache2</span></code>.</p>
</li>
<li><p>Install a webserver: This is standard and not Kompass specific, but we still include the
steps here for completeness. First, we need to install <code class="docutils literal notranslate"><span class="pre">apache2</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="go">apt install apache2</span>
</span><span id="line-2"><span class="go">a2enmod md ssl proxy proxy_http headers</span>
</span></code></pre></div>
</div>
<p>To allow the <code class="docutils literal notranslate"><span class="pre">md</span></code> module to automatically request a Let’s Encrypt certificate for our domain,
you need to accept the <a class="reference external" href="https://letsencrypt.org/documents/LE-SA-v1.4-April-3-2024.pdf">certificate agreement</a>. If you do, add the following line</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="n">MDCertificateAgreement</span> <span class="n">accepted</span>
</span></code></pre></div>
</div>
<p>to <code class="docutils literal notranslate"><span class="pre">/etc/apache2/apache2.conf</span></code>.</p>
<p>Then create a new file <code class="docutils literal notranslate"><span class="pre">/etc/apache2/sites-available/kompass.conf</span></code> with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="n">MDomain</span> <span class="n">jdav</span><span class="o">-</span><span class="n">town</span><span class="o">.</span><span class="n">de</span>
</span><span id="line-2">
</span><span id="line-3"><span class="o">&lt;</span><span class="n">VirtualHost</span> <span class="o">*</span><span class="p">:</span><span class="mi">443</span><span class="o">&gt;</span>
</span><span id="line-4">    <span class="n">ServerName</span> <span class="n">jdav</span><span class="o">-</span><span class="n">town</span><span class="o">.</span><span class="n">de</span>
</span><span id="line-5">    <span class="n">ServerAdmin</span> <span class="n">digital</span><span class="nd">@jdav</span><span class="o">-</span><span class="n">town</span><span class="o">.</span><span class="n">de</span>
</span><span id="line-6">
</span><span id="line-7">    <span class="n">SSLEngine</span> <span class="n">on</span>
</span><span id="line-8">    <span class="n">SSLOptions</span>      <span class="n">StrictRequire</span>
</span><span id="line-9">
</span><span id="line-10">    <span class="n">ErrorLog</span>   <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">apache2</span><span class="o">/</span><span class="n">error</span><span class="o">.</span><span class="n">log</span>
</span><span id="line-11">    <span class="n">LogLevel</span> <span class="n">warn</span>
</span><span id="line-12">
</span><span id="line-13">    <span class="n">CustomLog</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">apache2</span><span class="o">/</span><span class="n">access</span><span class="o">.</span><span class="n">log</span> <span class="n">vhost_combined</span>
</span><span id="line-14">    <span class="n">SSLProxyEngine</span> <span class="n">on</span>
</span><span id="line-15">
</span><span id="line-16">    <span class="n">ProxyPass</span> <span class="o">/</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">3000</span><span class="o">/</span>
</span><span id="line-17">    <span class="n">ProxyPassReverse</span> <span class="o">/</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">3000</span><span class="o">/</span>
</span><span id="line-18">    <span class="n">RequestHeader</span> <span class="nb">set</span> <span class="n">X</span><span class="o">-</span><span class="n">Forwarded</span><span class="o">-</span><span class="n">Proto</span> <span class="s2">"https"</span>
</span><span id="line-19">    <span class="n">RequestHeader</span> <span class="nb">set</span> <span class="n">X</span><span class="o">-</span><span class="n">Forwarded</span><span class="o">-</span><span class="n">Ssl</span> <span class="n">on</span>
</span><span id="line-20">    <span class="n">RequestHeader</span> <span class="nb">set</span> <span class="n">X</span><span class="o">-</span><span class="n">Forwarded</span><span class="o">-</span><span class="n">Port</span> <span class="mi">443</span>
</span><span id="line-21">
</span><span id="line-22"><span class="o">&lt;/</span><span class="n">VirtualHost</span><span class="o">&gt;</span>
</span></code></pre></div>
</div>
<p>Replace the <code class="docutils literal notranslate"><span class="pre">jdav-town.de</span></code> domain by a domain pointing to your server. Now activate the site
and restart apache:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="go">a2ensite kompass.conf</span>
</span><span id="line-2"><span class="go">systemctl restart apache2</span>
</span></code></pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">md</span></code> module should now request an SSL certificate from Let’s Encrypt, while this is still
pending you will receive a <em>connection not secure</em> error when visiting your domain. Check
<code class="docutils literal notranslate"><span class="pre">/var/log/apache2/error.log</span></code> for any possible errors. If everything worked, you will find there a
message similar to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="p">[</span><span class="n">Mon</span> <span class="n">Feb</span> <span class="mi">10</span> <span class="o">...</span><span class="p">]</span> <span class="o">...</span> <span class="p">:</span> <span class="n">The</span> <span class="n">Managed</span> <span class="n">Domain</span> <span class="o">...</span> <span class="n">has</span> <span class="n">been</span> <span class="n">setup</span> <span class="ow">and</span> <span class="n">changes</span> <span class="n">will</span> <span class="n">be</span> <span class="n">activated</span> <span class="n">on</span> <span class="nb">next</span> <span class="p">(</span><span class="n">graceful</span><span class="p">)</span> <span class="n">server</span> <span class="n">restart</span><span class="o">.</span>
</span></code></pre></div>
</div>
<p>In this case run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="go">systemctl restart apache2</span>
</span></code></pre></div>
</div>
<p>again. You should now see the Kompass application at your domain!</p>
</li>
<li><p>Update settings: Adapt <code class="docutils literal notranslate"><span class="pre">/opt/kompass/config/settings.toml</span></code> to your needs. If you followed the guide
as above, there should be no need to change anything in the <code class="docutils literal notranslate"><span class="pre">[database]</span></code> section.</p>
<div class="admonition note">
<p class="admonition-title">Bemerkung</p>
<p>We recommend to initialize a <code class="docutils literal notranslate"><span class="pre">git</span></code> repository in the <code class="docutils literal notranslate"><span class="pre">config</span></code> folder to version control any changes
to the local configuration.</p>
</div>
</li>
<li><p>Run the container in background mode: If everything is working, you can cancel the
<code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">compose</span> <span class="pre">up</span> <span class="pre">--build</span></code> command from above and run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="go">docker compose up -d --build</span>
</span></code></pre></div>
</div>
<p>Whenever you change your configuration or want to update to the latest version,
run this command again.</p>
</li>
<li><p>Setup mail configuration: The Kompass application needs a working mailserver for forwarding incoming
mails on personal mail accounts and on configured forward mail addresses. You can either setup
a mailserver on your own or use the docker-based <a class="reference external" href="https://git.jdav-hd.merten.dev/digitales/kompass-mailserver">Kompass-tailored mailserver</a>.</p>
<p>For receiving mails, no further changes to the <code class="docutils literal notranslate"><span class="pre">settings.toml</span></code> are needed. For sending mails,
the <code class="docutils literal notranslate"><span class="pre">[mail]</span></code> sections needs to be updated with authentication details for an SMTP server.</p>
<p>If you are using (and have already installed) the docker-based mailserver, proceed as follows:
In the Kompass administrative interface create a new user account (i.e. login data) with
a strong password and without staff access. Then update the <code class="docutils literal notranslate"><span class="pre">[mail]</span></code> section
in the <code class="docutils literal notranslate"><span class="pre">settings.toml</span></code> accordingly with the created user name and password.
The <code class="docutils literal notranslate"><span class="pre">host</span> <span class="pre">=</span> <span class="pre">'host'</span></code> setting is correct in this case and points to the underlying host.</p>
</li>
</ol>
</section>
<section id="local-configuration">
<h2>Local configuration<a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#local-configuration" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#local-configuration'">¶</a></h2>
<p>If you followed the steps outlined in <a class="reference internal" href="#user-manual-initial-installation"><span class="std std-ref">Initial installation</span></a>, you have a folder
<code class="docutils literal notranslate"><span class="pre">/opt/kompass/config</span></code> currently containing only a <code class="docutils literal notranslate"><span class="pre">settings.toml</span></code>.</p>
<p>While the <code class="docutils literal notranslate"><span class="pre">settings.toml</span></code> configures the most important options,
in practice you might want to have more control over texts on the website, used logos
or texts used in automatically generated emails. Here we will explain how to configure these.</p>
<ul>
<li><p>Mail texts: To modify the standard email texts, create a file <code class="docutils literal notranslate"><span class="pre">texts.toml</span></code> in your config
directory. This could then for example look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="n">confirm_mail</span> <span class="o">=</span> <span class="s2">"""</span>
</span><span id="line-2"><span class="s2">Hello </span><span class="si">{name}</span><span class="s2">,</span>
</span><span id="line-3">
</span><span id="line-4"><span class="s2">please confirm your email address! For this use the cool link at </span><span class="si">{link}</span><span class="s2">.</span>
</span><span id="line-5">
</span><span id="line-6"><span class="s2">..."""</span>
</span><span id="line-7">
</span><span id="line-8"><span class="n">new_unconfirmed_registration</span> <span class="o">=</span> <span class="s2">"""</span>
</span><span id="line-9"><span class="s2">Hi </span><span class="si">{name}</span><span class="s2">,</span>
</span><span id="line-10">
</span><span id="line-11"><span class="s2">your group </span><span class="si">{group}</span><span class="s2"> has a new registration! ..."""</span>
</span></code></pre></div>
</div>
</li>
<li><p>Templates: To override <code class="docutils literal notranslate"><span class="pre">.html</span></code> of the Kompass application, create a directory <code class="docutils literal notranslate"><span class="pre">templates</span></code> inside
your config directory. This is loaded as a regular templates directory by <code class="docutils literal notranslate"><span class="pre">django</span></code>, hence
you can override anything that lives in one of the many <code class="docutils literal notranslate"><span class="pre">templates</span></code> directories in the main repository.</p>
<p>For example, to fill the impressum page with content, you need to create a file
<code class="docutils literal notranslate"><span class="pre">templates/startpage/impressum_content.html</span></code>. In this file you can put any <code class="docutils literal notranslate"><span class="pre">.html</span></code> document and this
will be placed in the impressum page.</p>
<p>Typical templates to override here are (with their respective paths):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">templates/startpage/impressum_content</span></code>: impressum page</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">templates/startpage/faq_content</span></code>: group registration FAQ</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">templates/startpage/group_introduction</span></code>: introductory text placed above the group listing</p></li>
</ul>
</li>
</ul>
<p class="rubric">Footnotes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="ip-address" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a href="#id1" role="doc-backlink">1</a><span class="fn-bracket">]</span></span>
<p>The choice of the subnet <code class="docutils literal notranslate"><span class="pre">10.26.42.0/24</span></code> is arbitrarily chosen
from the <a class="reference external" href="https://en.wikipedia.org/wiki/Private_network#Private_IPv4_addresses">list of private IPv4 addresses</a>. If by coincidence this specific subnet
is already used on your system, you can replace this by any other subnet from the linked
list. Note that in this case you need to replace all references to <code class="docutils literal notranslate"><span class="pre">10.26.42.0/24</span></code>
and <code class="docutils literal notranslate"><span class="pre">10.26.42.1</span></code> by your choice, including in the <code class="docutils literal notranslate"><span class="pre">networks</span></code> section
of the <code class="docutils literal notranslate"><span class="pre">docker-compose.yaml</span></code>.</p>
</aside>
</aside>
</section>
</section>
</div><div class="flex justify-between items-center pt-6 mt-12 border-t border-border gap-4">
<div class="mr-auto">
<a class="inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors border border-input hover:bg-accent hover:text-accent-foreground py-2 px-4" href="testing.html">
<svg class="mr-2 h-4 w-4" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<polyline points="15 18 9 12 15 6"></polyline>
</svg>
        Testing
      </a>
</div>
</div></div><aside class="hidden text-sm xl:block" id="right-sidebar">
<div class="sticky top-16 -mt-10 max-h-[calc(100vh-5rem)] overflow-y-auto pt-6 space-y-2"><p class="font-medium">On this page</p>
<ul>
<li><a :data-current="activeSection === '#initial-installation'" class="reference internal" href="#initial-installation">Initial installation</a></li>
<li><a :data-current="activeSection === '#local-configuration'" class="reference internal" href="#local-configuration">Local configuration</a></li>
</ul>
</div>
</aside>
</main>
</div>
</div><footer class="py-6 border-t border-border md:py-0">
<div class="container flex flex-col items-center justify-between gap-4 md:h-24 md:flex-row">
<div class="flex flex-col items-center gap-4 px-8 md:flex-row md:gap-2 md:px-0">
<p class="text-sm leading-loose text-center text-muted-foreground md:text-left">© 2025, The Kompass Team Built with <a class="font-medium underline underline-offset-4" href="https://www.sphinx-doc.org" rel="noreferrer">Sphinx 7.4.7</a></p>
</div>
</div>
</footer>
</div><button :class="{'opacity-0 invisible' : !showScrollTop}" @click="window.scrollTo({top: 0, behavior: 'smooth'})" class="fixed bottom-8 right-8 p-2 z-10 rounded-sm bg-gray-700 text-xs text-white transition-all duration-1000 hover:bg-gray-950 focus:bg-gray-950" id="scrolltop" x-cloak="">
<svg aria-hidden="true" class="inline fill-current mb-[2px]" height="14" viewbox="0 96 960 960" width="14" xmlns="http://www.w3.org/2000/svg">
<path d="M450 896V370L202 618l-42-42 320-320 320 320-42 42-248-248v526h-60Z"></path>
</svg>
  Back to top
</button>
<script src="../_static/documentation_options.js?v=1da43640"></script>
<script src="../_static/doctools.js?v=9a2dae69"></script>
<script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
<script defer="defer" src="../_static/theme.js?v=073f68d9"></script>
<script src="../_static/translations.js?v=79cc9f76"></script>
</body>
</html>